<!DOCTYPE HTML>
<html lang="sk">
<head>
	<title>Prask &ndash; regulárne výrazy</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			font-family: system-ui;
			max-width: 50em;
			margin: 0 auto;
			padding: 0 12px;
		}

		code {
			font-family: system-ui;
			font-weight: bold;
		}

		input {
			appearance: none;
			display: block;
			font: inherit;
			border: 2px solid #ccc;
			padding: 5px;
			margin: 2px 0;
			width: 20em;
			max-width: 100%;
		}

		label {
			display: block;
			margin: 1em 0;
		}

		input:focus {
			outline: none
		}

		button {
			appearance: none;
			padding: 3px 8px;
			margin: 5px 0;
			border: 2px solid #ccc;
			font: inherit;
			cursor: pointer;
			background-color: #eee;
		}

		p button {
			margin: 5px 4px;
		}

		.correct {
			border: solid 2px #0b0;
		}

		.wrong, .invalid {
			border: solid 2px #d33;
		}

		.solved {
			background-color: #bf8;
			border: solid 2px #9d6;
		}

		.current {
			border: solid 2px #333;
		}
	</style>
</head>
<body>
<p>
	<strong>Úlohy</strong>
	<button id="p0" onclick="openP(0)">0</button>
	<button id="p1" onclick="openP(1)">1</button>
	<button id="p2" onclick="openP(2)">2</button>
	<button id="p3" onclick="openP(3)">3</button>
	<button id="p4" onclick="openP(4)">4</button>
	<button id="p5" onclick="openP(5)">5</button>
</p>
<p><strong>Napíš vzor, ktorému zodpovedajú práve také slová, že&hellip;</strong></p>
<p id="statement"></p>
<label>Vzor: <input
		id="pattern"
		autocomplete="off"
		autocorrect="off"
		autocapitalize="off"
		oninput="updateMatch(); save()"></label>
<label>Slovo: <input
		id="text"
		autocomplete="off"
		autocorrect="off"
		autocapitalize="off"
		oninput="updateMatch(); save()"></label>
<button onclick="test()">Otestovať vzor</label>
</body>
<script>
	var madeOfAB = "sa skladajú z písmen <code>a</code> a <code>b</code>";
	var madeOfABC = "sa skladajú z písmen <code>a</code>, <code>b</code>, <code>c</code>"
	var statements = [
		madeOfAB + " a druhé písmeno je <code>b</code>. Táto úloha je tutoriál a nie sú za ňu body.",
		madeOfAB + " a nikdy nie sú dve rovnaké písmená po sebe.",
		madeOfAB + " a začínajú a končia na rovnaké písmeno (prázdne slovo sa neráta).",
		madeOfAB + " a je v nich nepárny počet <code>a</code>-čiek.",
		madeOfABC + " a v každej trojici po sebe idúcich písmen sú všetky písmená rôzne.",
		madeOfABC + " a nikdy nie sú dve rovnaké písmená po sebe.",
	];
	var charsets = ["ab", "ab", "ab", "ab", "abc", "abc"];

	function openP(problem) {
		if (currentProblem !== null)
			document.getElementById("p" + currentProblem.toString()).classList.remove("current");
		currentProblem = problem;
		document.getElementById("statement").innerHTML = statements[problem];
		document.getElementById("p" + problem.toString()).classList.add("current");
		document.getElementById("pattern").value =
				localStorage.getItem("pattern" + currentProblem.toString()) || "";
		document.getElementById("text").value =
				localStorage.getItem("text" + currentProblem.toString()) || "";
		localStorage.setItem("lastOpened", currentProblem.toString());
		updateMatch();
	}

	function save() {
		localStorage.setItem(
				"pattern" + currentProblem.toString(),
				document.getElementById("pattern").value,
		);
		localStorage.setItem(
				"text" + currentProblem.toString(),
				document.getElementById("text").value,
		);
	}

	function makeRegex(regex) {
		return new RegExp("^(" + regex + ")$");
	}

	function validateRegex(regex) {
		var numOpenBrackets = 0, groupExists = false, openCharGroup = false;
		for (var i = 0; i < regex.length; i++) {
			if (openCharGroup) {
				var char = regex.charCodeAt(i)
				if (char === 93) {
					openCharGroup = false;
					groupExists = true;
				}
				else if ((char < 97) || (char > 122)) return false;
			}
			else switch (regex[i]) {
				case "[": openCharGroup = true; break;
				case "]": return false;
				case "?":
				case "*": if (!groupExists) return false; groupExists = false; break;
				case "(": numOpenBrackets++; groupExists = false; break;
				case ")":
					if (numOpenBrackets === 0) return false;
					numOpenBrackets--; groupExists = true;
					break;
				case "|": groupExists = false; break;
				default:
					var char = regex.charCodeAt(i);
					if ((char < 97) || (char > 122)) return false;
					groupExists = true;
			}
		}
		if (openCharGroup || numOpenBrackets !== 0) return false;
		return true;
	}

	function updateMatch() {
		var patternInput = document.getElementById("pattern");
		var textInput = document.getElementById("text");
		if (validateRegex(patternInput.value)) {
			patternInput.setAttribute("class", "");
			var regex = makeRegex(patternInput.value);
			if (regex.test(textInput.value)) textInput.setAttribute("class", "correct");
			else textInput.setAttribute("class", "wrong");
		}
		else {
			patternInput.setAttribute("class", "invalid");
			textInput.setAttribute("class", "");
		}
	}

	function sol0(text) { return text[1] === "b"; }
	function sol15(text) {
		for (var i = 1; i < text.length; i++)
			if (text[i - 1] === text[i]) return false;
		return true;
	}
	function sol2(text) { return (text.length !== 0) && (text[0] === text[text.length - 1]) }
	function sol3(text) {
		var count = 0;
		for (var i = 0; i < text.length; i++)
			if (text[i] === "a") count++;
		return count % 2 === 1;
	}
	function sol4(text) {
		if (text.length < 2) return true;
		if (text.length === 2) return !(text[0] === text[1]);
		for (var i = 2; i < text.length; i++)
			if (text[i - 2] === text[i - 1] || text[i - 2] === text[i] || text[i - 1] === text[i])
				return false;
		return true;
	}
	var solutions = [sol0, sol15, sol2, sol3, sol4, sol15];

	function nthString(charset, length, n) {
		var result = [];
		for (var i = 0; i < length; i++) {
			result.push(charset[n % charset.length]);
			n = Math.floor(n / charset.length);
		}
		return result.join("");
	}

	function test() {
		var pattern = document.getElementById("pattern").value;
		if (!validateRegex(pattern)) return;
		var regex = makeRegex(pattern);
		var solution = solutions[currentProblem], charset = charsets[currentProblem];
		var nStrings = 1, ok = true;
		outer: for (var length = 0; length < 11; length++) {
			for (var n = 0; n < nStrings; n++) {
				testcase = nthString(charset, length, n);
				if (solution(testcase) !== regex.test(testcase)) {
					//console.log(`nefunguje "${testcase}"`);
					ok = false;
					break outer;
				}
			}
			nStrings *= charset.length;
		}
		if (ok) {
			alert("Správne!");
			localStorage.setItem("solved" + currentProblem.toString(), "true");
			document.getElementById("p" + currentProblem.toString()).classList.add("solved");
		}
		else alert("Tento vzor nefunguje.");
	}

	var currentProblem = null;
	openP(parseInt(localStorage.getItem("lastOpened") || "0"));
	updateMatch();

	for (var i = 0; i <= 5; i++)
		if (localStorage.getItem("solved" + i.toString()) === "true")
			document.getElementById("p" + i.toString()).classList.add("solved");
</script>